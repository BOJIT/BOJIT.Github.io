<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    <meta name="description" content="BOJIT Projects, tutorials and ramblings.">
    <meta name="keywords" content="BOJIT,Github,James Bennion-Pedley,engineering,
    programming,Raspberry Pi,Linux,C++,MagicQ,lighting,theatre,electronics">

    <!--Author-->
    <meta name="author" content="James B-P">
    

    <!--Open Graph Title + Favicon -->
    <meta property="og:title" content="BOJIT"/>
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    
    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="BOJIT"/>

    <!--Type page-->
    <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="BOJIT>" />
    
    <!-- Title -->  
    <title>BOJIT - Kinect Interactive Bulb Grid</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/w3.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC|Comfortaa|Gloria+Hallelujah|Gochi+Hand|Kalam|Shadows+Into+Light&display=swap" rel="stylesheet">

    <!-- Styles -->
    <style> 
        body {
            margin: 0;
            padding: 0;
        }
        h2 {
            font-family: 'Gloria Hallelujah', cursive;
        }
        h4 {
            font-family: 'Gloria Hallelujah', cursive;
        }
        p {
            font-family: 'Comfortaa', cursive;
        }
        h2.link:hover {
            filter: invert(100%);
        }
        img.blog_panel {
            padding: 0;
            -moz-border-radius: 0px;
            -webkit-border-radius: 0px;
            border-radius: 0px;
            width: 100%;
        }
        .navbar.navbar-default {
            background-image: linear-gradient(rgba(0,0,0,1),rgba(0,0,0,0.6),rgba(0,0,0,0));
            border: 0;
            -webkit-box-shadow: none;
            box-shadow: none;
        }
        @media (max-width: 768px) {
            .navbar.navbar-default {
                background-image: linear-gradient(rgba(255,255,255,1),rgba(255,255,255,1));
            }
        }
        #null {
            font-family: 'Comfortaa', cursive;
            font-family: 'Gloria Hallelujah', cursive;
            font-family: 'Shadows Into Light', cursive;
            font-family: 'Amatic SC', cursive;
            font-family: 'Kalam', cursive;
            font-family: 'Gochi Hand', cursive;
        }
        .tile {
            position: relative;
            text-align: center;
            color: black;
        }
        .text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: .25s ease;
            display: none;
            pointer-events: none;
            font-family: 'Gloria Hallelujah', cursive;
            font-size: calc(6vw * var(--fontMultiplier));
        }
        .blog-item {
            width: var(--desktopWidth);
        }
        @media (max-width: 768px) {
            .text {
                font-size: calc(20vw * var(--fontMultiplier));
            }
            .blog-item {
                width: 100%;
            }   
        }
        img.blog_panel:hover + .text {
            display: block;
        }
    </style>

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141105755-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-141105755-1');
    </script>
</head>

<body>
    <!-- Menu -->
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button style="padding:15px" type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!-- Socials -->
                <div style="padding:10px">
                <ul class="list-inline navbar-left">
                    <li>
                        <a href="https://www.youtube.com/channel/UCR7zc0TblvkjPy9DhAWUkvA" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-youtube-play fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/in/james-bennion-pedley-bab14a146/" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/BOJIT" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.facebook.com/James.BOJIT" target="_blank">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                        </span>
                        </a>
                    </li>
                    <li>
                        <a href="https://soundcloud.com/james-bojit" target="_blank">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-soundcloud fa-stack-1x fa-inverse"></i>
                        </span>
                        </a>
                    </li>
                </ul>
                </div>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    <li>
                        <a href="/projects">Projects</a>
                    </li>
                    <li>
                        <a href="/tutorials">Tutorials</a>
                    </li>
                    <li>
                        <a href="/about">About</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Main Content -->

    <!-- Page Header -->
    <!-- Set your background image for this header in the theme's configuration: index_cover -->
    <header class="intro-header" style="background-image: url('/img/BannerSmall.jpg');padding:0px">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="w3-center w3-padding-32">
                        <br>
                        <br>
                        <br>
                        <img src="/img/BOJIT_Logo_Alias_Small.png" placeholder="BOJIT"></img>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="w3-container w3-center">
        <h2 class="heading" style="color:black"><b>KINECT INTERACTIVE BULB GRID:</b></h2>
        <h4 class="heading" style="color:gray">10-03-19</h4>
    </div>
    <div class="w3-container">
        <div class="w3-container">
            <p>
                This Spring our school hosted a production of Every Brilliant Thing, by Duncan Macmillan.
                This production was entirely student run, so we had a great deal more artistic freedom than most of our school shows permit.
                One afternoon, the director approached me with the expression of someone about to double your workload, and then
                raised the suggestion of making a grid of bulbs that could hang above the performance space (the show is
                performed in the round). <br>My initial reaction was somewhat dismissive, as the idea of driving nearly 40 incandescent
                lightbulbs off our school power distribution was frankly laughable. However, this conversation coincided with the arrival
                of some rather curious bulbs I found on Ebay. These bulbs were theose new COB LED 'filament-style' lamps that are
                all the rage right now. However, unlike many others I had seen, these were advertised as being DC-12V. Apparently they are
                intended for caravans and SUVs, but they are surprisingly hard to find. I could not find a single EU distributor of these
                bulbs, and only a handful of Ebay sellers. Here is the supplier <a href="https://www.ebay.co.uk/itm/S14-Led-E27-2W-Edison
                -Filament-Bulb-Lamp-Light-Warm-White-2700K-AC220V-DC12V-3V-/273353419840?var=" target="_blank">I used.</a><br>
                The DC variety are advertised as non-dimmable, but as the bulbs don't contain the same rectification stage that the AC-Variety
                use, I suspected that they could be dimmed with PWM just like a normal LED strip. This is not entirely true, but they do
                perform quite well in typical theatre use. Below is a short clip demonstrating the final outcome:
            </p>
            <div class="w3-container blog-item" style="margin:auto;--desktopWidth:60%">
                <div class="w3-center" style="position:relative;padding-top:56.25%;">
                    <iframe id="ytplayer" type="text/html"
                        src="https://www.youtube.com/embed/1h2riunyS8I?version=3&autoplay=1&loop=1&playlist=1h2riunyS8I&controls=0&modestbranding=1&mute=1"
                        frameborder="0" style="position:absolute;top:0;left:0;width:100%;height:100%;">
                    </iframe>
                </div>
            </div>
            <p>
                After asking the supplier and doing some digging online, I couldn't find anyone who had managed it successfully, so 
                decided to order a couple and experiment a bit. As the bulbs are only £1.39 shipped, I felt I could justify it! <br>
                Below is my test setup for testing the bulbs: essentially it is a cheap PWM dimmer which has been modified with an Arduino
                Nano to give it DMX input. In the final version I used <a href="https://www.ebay.co.uk/itm/36Channel-36CH-EASY-DMX-LED-RGB-
                Controller-DMX-Decoder-Driver-RGB-LED-Controrlle/153293163824?hash=item23b0fc0d30:g:wwEAAOSwmOBb6SKL:rk:6:pf:0" target="_blank">
                this 36 channel dimmer</a>, but I wanted to make sure that as a last resort I could get the system working with the Arduino's 
                Default PWM frequency of 490Hz (a good frequency that does not show up on our camcorders). This worked surprisingly well, all
                the way down to about 5% duty cycle. As with most LED dimmers, the dimming curve is not linear: a change from 0-10% corresponds to 
                a brightness change of about 50% at the bottom end. This makes very slow fades problematic. Moreover, at approx. 2% duty cycle the
                bulbs tend to violently flicker, which leads me to believe that there is some sort of constant-current circuitry inside the bulbs 
                (while tempting to smash one open and check, I only had two bulbs, and I did not fancy waiting another 6 weeks for a replacement).
                <br>Despite being a bit snappy at low intensity, as well as the very occasional flicker, these bulbs performed very well under
                theatre lighting, and their low power-consumption and cost made them ideal for large grid installations. The entire 36 bulb grid
                ended up costing roughly £120 to build, and drew a peak of about 80W (the equivalent of two incandescent bulbs!).
            </p>
            <div class="w3-container blog-item" style="margin:auto;--desktopWidth:50%">
                <img src="img/light_test.JPG" placeholder="Bulb Testing" width="100%">
            </div>
            <p>
                When we initially devised the plans for the grid, we had not thought about using a Kinect to make the system interactive. Without
                the Kinect the grid was relatively simple (albeit time-consuming) to make. The grid was essentially a 2.4m CLS square with a rope 
                mesh reinforced with zip-ties at the intersections. To keep the grid stable when hanging, I make a central platform to hold the
                power supply and LED driver board. This also was used to mount the Kinect. A note to anyone attempting something like this: measure
                the size of the doors to your theatre before making the frame! We managed to make the frame 2cm wider than our school doorways, so
                moving the frame between rooms was frankly a nightmare.
            </p>
            <div class="w3-container blog-item" style="margin:auto;--desktopWidth:50%">
                <img src="img/bulbs.jpeg" placeholder="bulbs" width="100%">
            </div>
            <p>
                Lately I have done a lot of playing about with a program called Touchdesigner. It is essentially a visual scripting and
                manipulation tool. It is often used for projection mapping, but the large variety of input/output operators make it a very 
                flexible tool in visual FX. To get an idea of what it can do, I would highly encourage you to read 
                <a href="https://www.derivative.ca/Events/2014/Gravity/" target="_blank">this article</a> showing
                how Touchdesigner was used in the making of the film 'Gravity'. The really nice thing is that Touchdesigner is free for
                non-commercial use, with a resolution limit of 1280x1280. A resolution of 6x6 falls well below this threshold!
                Principally, Touchdesigner offers a much more powerful pixel-mapping engine than most lighting consoles (in our case MagicQ), 
                however the developers have added support for a variety of external inputs, including the Kinect.<br>
                Programming an entire theatre show in Touchdesigner is not practical, so we needed some way to merge the two DMX signals.
                As it happens, the DMX splitters in our venue have 2 inputs that are merged based on HTP, but an alternative to this is to
                send both outputs to the same address over Artnet. In Touchdesigner I set up a network that takes an input in the form of a
                black and white image and generates a series of channel values that can be output over DMX. The core pixel-mapping engine is 
                pictured below, and I have attached the Touchdesigner File <a href="./Kinect_Grid.toe" target="_blank" download>here</a> if
                anyone is interested.
            </p>
            <div class="w3-container blog-item" style="margin:auto;--desktopWidth:70%">
                <img src="img/touchdesigner.PNG" placeholder="Touchdesigner" width="100%">
            </div>
            <p>
                The raw kinect data needed to be processed heavily before the output started leaving the lovely trails seen in the demonstration
                above. This processing needs to be done with as little latency as possible, but before considering how to tackle this I had a 
                somewhat more urgent problem. The Kinect is hanging in the centre of our studio, but the control room (along with the desktop PC
                running touchdesigner) is located about 20m away on a different floor of the building (pictured below). The Kinect V1 is connected by a 480Mbps USB
                connection, and USB is not designed to be run over such long distances. There are plenty of USB extenders on the market, but only
                <b>one</b> is known to work with the Kinect V1, and none are known to work with the Kinect V2. Considering the USB extender in question
                costs £350, I was determined to find an alternative. The solution in the end was rather bodged, but worked reliably for every show:
                I hung an old laptop from the roof of the theatre near to the Kinect, and ran a demo file from the Kinect SDK on the laptop that simply
                displayed the depth stream on the screen. I then used OBS (Open Broadcaster Software) to create an NDI stream that I could send over
                Cat5 to the desktop PC. I then used Newtek's <i>virtual input</i> to create a virtual webcam that could be input into Touchdesigner.
                This sounds incredibly inefficient, but I managed to achieve sub 150ms latency, which was acceptable for the application.
                Note that if the laptop in the roof could run Touchdesigner, I could have sent the data from one PC to another using the software,
                however the old laptop was not up to the task. In fact, I am working on a more professional solution to streaming Kinect data, which
                I am hoping to have published by the end of September.
            </p>
            <div class="w3-container blog-item" style="margin:auto;--desktopWidth:50%">
                <img src="img/control.jpg" placeholder="control room" width="100%">
            </div>
            <p>
                Once I was able to get a depth stream into Touchdesigner, I could begin processing the data to make the trails, along with some other
                visual effects that could be mixed in during the show. As the Kinect is looking at actors from above, the built-in tracking features don't
                really work here. Essentially the processing consisted of multiple stages of feedback and luminance threshold filtering, along with
                a compensation stage that corrected for the non-linearity in the bulb dimming. It is also worth noting that with theatrical installations
                such as this, subtlety is key, so we had to find a way of incorporating the elements of interactivity without them overpowering the
                acting.<br>
                This setup was very fun to play with once we got it up and running, and I was personally surprised at how effective pixel-mapped 
                effects could be with only a 6x6 grid. As for the Kinect implementation, while this was a good starting point, I feel I have a lot more
                work to do before implementing the Kinect in theatre productions becomes hassle-free! Below is a look from below of the grid with a chase
                running to demonstrate the dimming curve of the bulbs.
            </p>
            <div class="w3-container blog-item" style="margin:auto;--desktopWidth:50%">
                <img src="img/grid.jpg" placeholder="grid" width="100%">
            </div>
            <br>
            <div class="w3-container blog-item" style="margin:auto;--desktopWidth:50%">
                <div class="w3-center" style="position:relative;padding-top:56.25%;">
                    <iframe id="ytplayer" type="text/html"
                        src="https://www.youtube.com/embed/KqTWhsiiKgE?version=3&autoplay=1&loop=1&playlist=KqTWhsiiKgE&controls=0&modestbranding=1&mute=1"
                        frameborder="0" style="position:absolute;top:0;left:0;width:100%;height:100%;">
                    </iframe>
                </div>
            </div>
            <p>
                As for the show itself, in contrast to previous student productions, it was a resounding succes! I would highly reccomend looking
                up the original play by Duncan Macmillan. While our director modified the play to be performed by an ensemble, it is originally a
                monologue, performed without any stage lighting or effects at all.<br><br>
                I have written a separate article outlining the Touchdesigner pixel-mapping engine and how to interface with it. That can be found 
                <a href="/tutorials/2019/03/31/Touchdesigner/">here</a>.
            </p>
            <a href="https://www.facebook.com/events/291397161524474/" style="text-decoration:none">
            <div class="w3-panel w3-gray w3-center w3-hover-opacity"><h2>Click Here to go to Original Event Page:</h2></div></a>
            <br>
            <div class="w3-container blog-item" style="margin:auto;--desktopWidth:70%">
                <img src="img/curtain_call.jpeg" placeholder="Curtain Call" width="100%">
            </div>
        </div>
    </div>

    <!-- Footer -->
    <hr />

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="https://www.youtube.com/channel/UCR7zc0TblvkjPy9DhAWUkvA" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-youtube-play fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.linkedin.com/in/james-bennion-pedley-bab14a146/" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/BOJIT" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.facebook.com/James.BOJIT" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://soundcloud.com/james-bojit" target="_blank">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-soundcloud fa-stack-1x fa-inverse"></i>
                            </span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- After footer scripts -->
    
    <!-- Tiler -->
    <script src="js/display.js"></script>
    
    <!-- jQuery -->
    <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

    <!-- Bootstrap -->
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- Gallery -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>
</body>

</html>