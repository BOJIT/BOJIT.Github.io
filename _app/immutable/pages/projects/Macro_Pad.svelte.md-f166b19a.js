import{S as At,i as Dt,s as Ht,e as i,t as o,k as h,w as jt,c as l,a as r,h as n,d as a,m as c,x as Kt,b as u,U as fe,g as p,K as t,y as Ot,E as Lt,q as qt,o as Nt,B as $t}from"../../chunks/index-5dfa2933.js";import{C as Jt}from"../../chunks/prism-c-30ee303a.js";import"../../chunks/prism-a46989fb.js";import"../../chunks/Notification-7f4998ec.js";import"../../chunks/index-edf86401.js";import"../../chunks/ripple-59eba3d5.js";/* empty css                                                            */function Ft(Ut){let m,ye,O,ke,be,L,ve,ge,_,we,_e,W,d,q,Be,Pe,N,Te,Ie,$,Me,Se,J,Ee,Ce,F,Ue,xe,R,Ge,Z,S,Ae,ee,E,C,st,te,U,De,ae,x,G,ot,se,f,He,V,je,Ke,B,Oe,Le,X,qe,Ne,oe,A,D,nt,ne,b,$e,P,Je,Fe,ie,H,Re,le,T,re,I,xt=`<code class="language-c"><span class="token keyword">int</span> KeyMap<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span>            <span class="token punctuation">&#123;</span>KeyL1<span class="token punctuation">,</span>    KeyL2<span class="token punctuation">,</span>    KeyL3<span class="token punctuation">,</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
<span class="token class-name">uint8_t</span> KeyCodes<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span>      <span class="token punctuation">&#123;</span><span class="token number">50</span><span class="token punctuation">,</span>       <span class="token number">91</span><span class="token punctuation">,</span>       <span class="token number">99</span><span class="token punctuation">,</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
<span class="token class-name">uint8_t</span> KeyMod1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span>       <span class="token punctuation">&#123;</span>SHIFTKEY<span class="token punctuation">,</span> SHIFTKEY<span class="token punctuation">,</span> CTRLKEY<span class="token punctuation">,</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span>
<span class="token class-name">uint8_t</span> KeyMod2<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span>       <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span>        <span class="token number">0</span><span class="token punctuation">,</span>        SHIFTKEY<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span></code>`,pe,v,Ve,Y,Xe,Ye,he,y,ze,z,Qe,We,M,Ze,et,Q,tt,at,ce,j,K,it,ue;return T=new Jt({}),{c(){m=i("p"),ye=o("Lately I\u2019ve been doing a lot of playing about with those STM32 \u2018BluePill\u2019 boards that are all over "),O=i("em"),ke=o("Aliexpress"),be=o(" and "),L=i("em"),ve=o("eBay"),ge=o(`. Their 32-bit processor packs a lot more punch than the ATMega328p that is at the heart of the Arduino Nano that had been my previous go-to board for various projects. They are also so unbelievably cheap (as low as \xA31.50 each from China) that I try to maintain a stock of at least 10 at all times.
The other big advantage of the STM32F103 chips is that unlike the ATMega328p they have a built-in USB controller which can support OTG and HID. This makes the boards very handy for making quick and dirty USB devices. In particular, there is a library published by `),_=i("a"),we=o("arpruss"),_e=o(" which makes it really easy to create \u2018composite USB\u2019 devices (devices that have multiple endpoints/services supported over the same connection). The library currently supports:"),W=h(),d=i("ul"),q=i("li"),Be=o("USB HID (keyboards, mice, joysticks, etc\u2026)"),Pe=h(),N=i("li"),Te=o("MIDI over USB"),Ie=h(),$=i("li"),Me=o("XBox360 Controller Emulation"),Se=h(),J=i("li"),Ee=o("USB storage"),Ce=h(),F=i("li"),Ue=o("USB audio"),xe=h(),R=i("li"),Ge=o("Standard USB Serial"),Z=h(),S=i("p"),Ae=o("The best part is that you can make a device with any combination of these attributes (within the limits of the library/hardware), so you can for example have a USB MIDI device, but simultaneously have a USB Serial connection for debugging."),ee=h(),E=i("p"),C=i("img"),te=h(),U=i("p"),De=o("I had plenty of these boards laying about, and as I was ordering some PCBs for another project at the time, I decided to quickly throw together a macro keypad and tag the PCB onto my order. The final result is pictured below: This one was made for a friend who does a lot of video editing (anyone who has used DaVinci Resolve probably recognises the symbols). The design is about as simple as it gets - the PCB is the frame, and the only components required are the BluePill, the switches and a single resistor. It doesn\u2019t have all the bells and whistles of a commercial macro-pad, but if you are ordering PCBs anyway and don\u2019t count any extra shipping, the BOM of this little macro pad is less than \xA35. Needless to say, I didn\u2019t use genuine Cherry MX Browns!"),ae=h(),x=i("p"),G=i("img"),se=h(),f=i("p"),He=o("The PCB design for the macro keypad is very simple. As the STM32 has internal pullups/pulldowns it is simply a matter of placing the keys in a grid and routing the keys to the inputs of the BluePill. The only other detail required is an 18k resistor pulling the "),V=i("em"),je=o("USB D+"),Ke=o(" line up to 3.3V. This is to correct for a hardware bug that all BluePills seem to have (see "),B=i("a"),Oe=o("this article"),Le=o(` for more details).
One thing to note with the layout pictured below is that it is designed to have the STM32 soldered in with the pins on the top side. This makes the design lower profile, and also protects the micro-USB connector. However to get this to fit flush to the PCB the yellow `),X=i("code"),qe=o("BOOT"),Ne=o(` jumpers have to be desoldered and bridged.
It is also always worth reinforcing the solder joints that attach the USB connector shield/chassis, as they are generally quite weedy and prone to breaking.`),oe=h(),A=i("p"),D=i("img"),ne=h(),b=i("p"),$e=o("The source code for this macro-pad is on "),P=i("a"),Je=o("GitHub"),Fe=o(", and to simplify things as much as possible, the keycodes are hard-coded into the source. This does mean that to change the macros you do need to reprogram the BluePill, but for my use cases I don\u2019t forsee myself needing to change the macros very often."),ie=h(),H=i("p"),Re=o("To simplify things when editing the keyboard layout, the HID keycodes are defined globally in a set of arrays as follows:"),le=h(),jt(T.$$.fragment),re=h(),I=i("pre"),pe=h(),v=i("p"),Ve=o("It is worth noting that the code for my macro keypad treats key 12 as a \u2018shift\u2019  key, which allows users to double up the functionality of the keys. These secondary functions are set using the "),Y=i("code"),Xe=o("AltKeyCodes"),Ye=o(" section of the global declarations."),he=h(),y=i("p"),ze=o("This is by no means a particularly advanced or great macro keypad, but they are very cheap and simple to make, and a fun thing to tag on to the end of a PCB order to save on postage. They also make great gifts! I have a few "),z=i("em"),Qe=o("HC-05"),We=o("s in the post, and once they arrive I may try and make these into a Bluetooth macro keypad at some point. If you are interested in doing something like that I would highly recommend checking out "),M=i("a"),Ze=o("this article"),et=o(" by "),Q=i("strong"),tt=o("Mitxela"),at=o(" (and the rest of his website too, while you\u2019re at it!)"),ce=h(),j=i("p"),K=i("img"),this.h()},l(e){m=l(e,"P",{});var s=r(m);ye=n(s,"Lately I\u2019ve been doing a lot of playing about with those STM32 \u2018BluePill\u2019 boards that are all over "),O=l(s,"EM",{});var lt=r(O);ke=n(lt,"Aliexpress"),lt.forEach(a),be=n(s," and "),L=l(s,"EM",{});var rt=r(L);ve=n(rt,"eBay"),rt.forEach(a),ge=n(s,`. Their 32-bit processor packs a lot more punch than the ATMega328p that is at the heart of the Arduino Nano that had been my previous go-to board for various projects. They are also so unbelievably cheap (as low as \xA31.50 each from China) that I try to maintain a stock of at least 10 at all times.
The other big advantage of the STM32F103 chips is that unlike the ATMega328p they have a built-in USB controller which can support OTG and HID. This makes the boards very handy for making quick and dirty USB devices. In particular, there is a library published by `),_=l(s,"A",{href:!0,rel:!0});var pt=r(_);we=n(pt,"arpruss"),pt.forEach(a),_e=n(s," which makes it really easy to create \u2018composite USB\u2019 devices (devices that have multiple endpoints/services supported over the same connection). The library currently supports:"),s.forEach(a),W=c(e),d=l(e,"UL",{});var k=r(d);q=l(k,"LI",{});var ht=r(q);Be=n(ht,"USB HID (keyboards, mice, joysticks, etc\u2026)"),ht.forEach(a),Pe=c(k),N=l(k,"LI",{});var ct=r(N);Te=n(ct,"MIDI over USB"),ct.forEach(a),Ie=c(k),$=l(k,"LI",{});var ut=r($);Me=n(ut,"XBox360 Controller Emulation"),ut.forEach(a),Se=c(k),J=l(k,"LI",{});var dt=r(J);Ee=n(dt,"USB storage"),dt.forEach(a),Ce=c(k),F=l(k,"LI",{});var mt=r(F);Ue=n(mt,"USB audio"),mt.forEach(a),xe=c(k),R=l(k,"LI",{});var ft=r(R);Ge=n(ft,"Standard USB Serial"),ft.forEach(a),k.forEach(a),Z=c(e),S=l(e,"P",{});var yt=r(S);Ae=n(yt,"The best part is that you can make a device with any combination of these attributes (within the limits of the library/hardware), so you can for example have a USB MIDI device, but simultaneously have a USB Serial connection for debugging."),yt.forEach(a),ee=c(e),E=l(e,"P",{});var kt=r(E);C=l(kt,"IMG",{src:!0,alt:!0}),kt.forEach(a),te=c(e),U=l(e,"P",{});var bt=r(U);De=n(bt,"I had plenty of these boards laying about, and as I was ordering some PCBs for another project at the time, I decided to quickly throw together a macro keypad and tag the PCB onto my order. The final result is pictured below: This one was made for a friend who does a lot of video editing (anyone who has used DaVinci Resolve probably recognises the symbols). The design is about as simple as it gets - the PCB is the frame, and the only components required are the BluePill, the switches and a single resistor. It doesn\u2019t have all the bells and whistles of a commercial macro-pad, but if you are ordering PCBs anyway and don\u2019t count any extra shipping, the BOM of this little macro pad is less than \xA35. Needless to say, I didn\u2019t use genuine Cherry MX Browns!"),bt.forEach(a),ae=c(e),x=l(e,"P",{});var vt=r(x);G=l(vt,"IMG",{src:!0,alt:!0}),vt.forEach(a),se=c(e),f=l(e,"P",{});var g=r(f);He=n(g,"The PCB design for the macro keypad is very simple. As the STM32 has internal pullups/pulldowns it is simply a matter of placing the keys in a grid and routing the keys to the inputs of the BluePill. The only other detail required is an 18k resistor pulling the "),V=l(g,"EM",{});var gt=r(V);je=n(gt,"USB D+"),gt.forEach(a),Ke=n(g," line up to 3.3V. This is to correct for a hardware bug that all BluePills seem to have (see "),B=l(g,"A",{href:!0,rel:!0});var wt=r(B);Oe=n(wt,"this article"),wt.forEach(a),Le=n(g,` for more details).
One thing to note with the layout pictured below is that it is designed to have the STM32 soldered in with the pins on the top side. This makes the design lower profile, and also protects the micro-USB connector. However to get this to fit flush to the PCB the yellow `),X=l(g,"CODE",{});var _t=r(X);qe=n(_t,"BOOT"),_t.forEach(a),Ne=n(g,` jumpers have to be desoldered and bridged.
It is also always worth reinforcing the solder joints that attach the USB connector shield/chassis, as they are generally quite weedy and prone to breaking.`),g.forEach(a),oe=c(e),A=l(e,"P",{});var Bt=r(A);D=l(Bt,"IMG",{src:!0,alt:!0}),Bt.forEach(a),ne=c(e),b=l(e,"P",{});var de=r(b);$e=n(de,"The source code for this macro-pad is on "),P=l(de,"A",{href:!0,rel:!0});var Pt=r(P);Je=n(Pt,"GitHub"),Pt.forEach(a),Fe=n(de,", and to simplify things as much as possible, the keycodes are hard-coded into the source. This does mean that to change the macros you do need to reprogram the BluePill, but for my use cases I don\u2019t forsee myself needing to change the macros very often."),de.forEach(a),ie=c(e),H=l(e,"P",{});var Tt=r(H);Re=n(Tt,"To simplify things when editing the keyboard layout, the HID keycodes are defined globally in a set of arrays as follows:"),Tt.forEach(a),le=c(e),Kt(T.$$.fragment,e),re=c(e),I=l(e,"PRE",{class:!0});var Gt=r(I);Gt.forEach(a),pe=c(e),v=l(e,"P",{});var me=r(v);Ve=n(me,"It is worth noting that the code for my macro keypad treats key 12 as a \u2018shift\u2019  key, which allows users to double up the functionality of the keys. These secondary functions are set using the "),Y=l(me,"CODE",{});var It=r(Y);Xe=n(It,"AltKeyCodes"),It.forEach(a),Ye=n(me," section of the global declarations."),me.forEach(a),he=c(e),y=l(e,"P",{});var w=r(y);ze=n(w,"This is by no means a particularly advanced or great macro keypad, but they are very cheap and simple to make, and a fun thing to tag on to the end of a PCB order to save on postage. They also make great gifts! I have a few "),z=l(w,"EM",{});var Mt=r(z);Qe=n(Mt,"HC-05"),Mt.forEach(a),We=n(w,"s in the post, and once they arrive I may try and make these into a Bluetooth macro keypad at some point. If you are interested in doing something like that I would highly recommend checking out "),M=l(w,"A",{href:!0,rel:!0});var St=r(M);Ze=n(St,"this article"),St.forEach(a),et=n(w," by "),Q=l(w,"STRONG",{});var Et=r(Q);tt=n(Et,"Mitxela"),Et.forEach(a),at=n(w," (and the rest of his website too, while you\u2019re at it!)"),w.forEach(a),ce=c(e),j=l(e,"P",{});var Ct=r(j);K=l(Ct,"IMG",{src:!0,alt:!0}),Ct.forEach(a),this.h()},h(){u(_,"href","https://github.com/arpruss/USBComposite_stm32f1"),u(_,"rel","nofollow"),fe(C.src,st="https://cdn.bojit.org/img/posts/Macro_Pad-Bluepill.JPG")||u(C,"src",st),u(C,"alt","Macro_Pad-Bluepill.JPG"),fe(G.src,ot="https://cdn.bojit.org/img/posts/Macro_Pad-Macro_Pad.JPG")||u(G,"src",ot),u(G,"alt","Macro_Pad-Macro_Pad.JPG"),u(B,"href","http://amitesh-singh.github.io/stm32/2017/05/27/Overcoming-wrong-pullup-in-blue-pill.html"),u(B,"rel","nofollow"),fe(D.src,nt="https://cdn.bojit.org/img/posts/Macro_Pad-PCB.PNG")||u(D,"src",nt),u(D,"alt","Macro_Pad-PCB.PNG"),u(P,"href","https://github.com/BOJIT/Blue-Pill-Macro-Pad"),u(P,"rel","nofollow"),u(I,"class","language-c"),u(M,"href","https://mitxela.com/projects/bluetooth_hid_gamepad"),u(M,"rel","nofollow"),fe(K.src,it="https://cdn.bojit.org/img/posts/Macro_Pad-Boxed.JPG")||u(K,"src",it),u(K,"alt","Macro_Pad-Boxed.JPG")},m(e,s){p(e,m,s),t(m,ye),t(m,O),t(O,ke),t(m,be),t(m,L),t(L,ve),t(m,ge),t(m,_),t(_,we),t(m,_e),p(e,W,s),p(e,d,s),t(d,q),t(q,Be),t(d,Pe),t(d,N),t(N,Te),t(d,Ie),t(d,$),t($,Me),t(d,Se),t(d,J),t(J,Ee),t(d,Ce),t(d,F),t(F,Ue),t(d,xe),t(d,R),t(R,Ge),p(e,Z,s),p(e,S,s),t(S,Ae),p(e,ee,s),p(e,E,s),t(E,C),p(e,te,s),p(e,U,s),t(U,De),p(e,ae,s),p(e,x,s),t(x,G),p(e,se,s),p(e,f,s),t(f,He),t(f,V),t(V,je),t(f,Ke),t(f,B),t(B,Oe),t(f,Le),t(f,X),t(X,qe),t(f,Ne),p(e,oe,s),p(e,A,s),t(A,D),p(e,ne,s),p(e,b,s),t(b,$e),t(b,P),t(P,Je),t(b,Fe),p(e,ie,s),p(e,H,s),t(H,Re),p(e,le,s),Ot(T,e,s),p(e,re,s),p(e,I,s),I.innerHTML=xt,p(e,pe,s),p(e,v,s),t(v,Ve),t(v,Y),t(Y,Xe),t(v,Ye),p(e,he,s),p(e,y,s),t(y,ze),t(y,z),t(z,Qe),t(y,We),t(y,M),t(M,Ze),t(y,et),t(y,Q),t(Q,tt),t(y,at),p(e,ce,s),p(e,j,s),t(j,K),ue=!0},p:Lt,i(e){ue||(qt(T.$$.fragment,e),ue=!0)},o(e){Nt(T.$$.fragment,e),ue=!1},d(e){e&&a(m),e&&a(W),e&&a(d),e&&a(Z),e&&a(S),e&&a(ee),e&&a(E),e&&a(te),e&&a(U),e&&a(ae),e&&a(x),e&&a(se),e&&a(f),e&&a(oe),e&&a(A),e&&a(ne),e&&a(b),e&&a(ie),e&&a(H),e&&a(le),$t(T,e),e&&a(re),e&&a(I),e&&a(pe),e&&a(v),e&&a(he),e&&a(y),e&&a(ce),e&&a(j)}}}const Zt={title:"BluePill Macro Keypad",date:"17-08-2019",published:!0,tile:{type:"image",image:"/tiles/2019-08-17-Macro_Pad.PNG"}};class ea extends At{constructor(m){super(),Dt(this,m,null,Ft,Ht,{})}}export{ea as default,Zt as metadata};
