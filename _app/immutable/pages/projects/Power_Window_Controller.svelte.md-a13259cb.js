import{S as go,i as Eo,s as Po,e as i,t as n,k as d,c as l,a,h,d as t,m as c,b as w,U as Le,g as s,K as o,E as Wt}from"../../chunks/index-cabb4aca.js";function To(_o){let p,Ve,P,Be,Je,we,T,Ne,pe,I,He,me,k,C,jt,ve,W,Ye,ye,j,qe,be,m,U,z,Oe,Ue,K,Q,ze,Ke,R,g,Qe,X,Re,Xe,_e,G,Ze,ge,D,M,Gt,Ee,S,$e,Pe,A,et,Te,y,Z,$,tt,ot,ee,te,it,Ie,v,lt,oe,rt,at,ie,st,nt,ke,x,ht,Ce,F,L,Dt,We,V,dt,je,f,le,re,ct,ft,ae,se,ut,wt,ne,he,pt,mt,de,ce,vt,Ge,B,yt,De,u,bt,fe,_t,gt,ue,Et,Pt,E,Tt,It,Me,J,N,Mt,Se,H,kt,Ae,Y,Ct;return{c(){p=i("p"),Ve=n("This project is part of my larger "),P=i("a"),Be=n("van overhaul"),Je=n(", however I thought it would make more sense to break out into its own article."),we=d(),T=i("p"),Ne=n("For some context, when I bought my van it did not have any window regulators in. For some inexplicable reason the previous owner had decided to remove them and install electric windows, despite the fact that the vehicle didn\u2019t have a working engine. When I bought the van, it came with two electric window regulators, and the windows themselves were held up with pliers!"),pe=d(),I=i("p"),He=n("This article shows my crude attempt at adding a DIY window control mechanism to my van, and some of the challenges surrounding the design\u2026"),me=d(),k=i("p"),C=i("img"),ve=d(),W=i("p"),Ye=n("I should note that the design for this controller was largely dictated by what I had on hand, so by no means serves as a reference implementation! However, the key requirements of a controller are fairly basic, so there are likely many valid ways to build this device."),ye=d(),j=i("p"),qe=n("The first major consideration is that many window regulators don\u2019t come with any kind of stopping mechanism fitted. Essentially you drive the window up/down until the motor stalls. A very simple controller would to simply have a DPDT switch that directly connects the window motors to a fused 12V line, however this does have some drawbacks:"),be=d(),m=i("ul"),U=i("li"),z=i("p"),Oe=n("The switches need to be rated for the full motor stall current. This could be as high as 35A!"),Ue=d(),K=i("li"),Q=i("p"),ze=n("If you hold down the switch while the window is at its limit, you are effectively shorting out your battery through a stalled motor coil. This may burn out your motor/get hot!"),Ke=d(),R=i("li"),g=i("p"),Qe=n("You cannot implement smart features like "),X=i("em"),Re=n("single-touch"),Xe=n(" window closing."),_e=d(),G=i("p"),Ze=n("Naturally, my first response was to go fully overkill, and design a fully software-controllable window controller based around the ubiquitous \u2018blue-pill\u2019 STM32 microcontroller. The schematic for my controller is shown below."),ge=d(),D=i("p"),M=i("img"),Ee=d(),S=i("p"),$e=n("This circuit is very simple, and can be modified to work with whatever components you happen to have on-hand. The core window control is done using 4 automotive relays, each driven by a simple BJT low-side switch. Virtually any rated N-Channel FET would suffice for this application."),Pe=d(),A=i("p"),et=n("This switching configuration uses standard SPDT automotive relays. By default both motor terminals are connected to GND. You can spin the motor in either direction by switching one of the relays. This circuit has two neat features:"),Te=d(),y=i("ul"),Z=i("li"),$=i("p"),tt=n("When the relays are off, the motor terminals are shorted together. This gives a nice return path for back-EMF, removing the need for any freewheeling diodes."),ot=d(),ee=i("li"),te=i("p"),it=n("There is no software configuration that can accidentally short out the supply rails as one can with H-Bridge topologies."),Ie=d(),v=i("p"),lt=n("The \u2018stall\u2019 detection is done with "),oe=i("code"),rt=n("ACS172"),at=n(" hall-effect current sensors. These are cheap ICs that do not add considerable impedance to the measured current path. They are not particularly accurate, but that isn\u2019t too problematic in this scenario. The main drawback of the "),ie=i("code"),st=n("ACS172"),nt=n(" is that it is a 5 Volt part. For interfacing with a 3V3 microcontroller I added voltage dividers to adjust the sensor range (throwing in a couple of 3V3 zener diodes doesn\u2019t hurt either)."),ke=d(),x=i("p"),ht=n("The \u2018module\u2019 in its final form is shown below. It is by no means the most compact, but hey, overkill electrics is something of a theme in my van."),Ce=d(),F=i("p"),L=i("img"),We=d(),V=i("p"),dt=n("All that was left was to program the software. While the software isn\u2019t a brain-melter, it isn\u2019t as straightforward as I initially thought. There are actually a number of different behaviours and states that need to be accounted for, along with safely handling any potential exceptions, for example:"),je=d(),f=i("ul"),le=i("li"),re=i("p"),ct=n("Holding the close button after the window has fully closed."),ft=d(),ae=i("li"),se=i("p"),ut=n("Automatically opening/closing the window if the switch is held down for a short period of time, but remaining in manual mode if held down for a long period of time."),wt=d(),ne=i("li"),he=i("p"),pt=n("Cancelling auto-closing if user touches controls"),mt=d(),de=i("li"),ce=i("p"),vt=n("Stopping window movements if the window hasn\u2019t reached a known state within a certain time window."),Ge=d(),B=i("p"),yt=n("Furthermore, our current thresholds for stalling are different depending on whether the window is moving up or down, and depending on whether the engine is running or not!"),De=d(),u=i("p"),bt=n("My software is implemented as a "),fe=i("code"),_t=n("C++"),gt=d(),ue=i("em"),Et=n("Class State Machine"),Pt=n(", and is available on "),E=i("a"),Tt=n("GitHub"),It=n(". It needs a bit of tweaking to get reliable operation, but is very solid once configured correctly."),Me=d(),J=i("p"),N=i("img"),Se=d(),H=i("p"),kt=n("Was this controller a good idea when a couple of high-powered switches would have sufficed? Probably not."),Ae=d(),Y=i("p"),Ct=n("But hey, my van is the epitome of projects that really don\u2019t justify the time put into them, but that\u2019s not really the point of these kind of projects\u2026 at least in my book!"),this.h()},l(e){p=l(e,"P",{});var r=a(p);Ve=h(r,"This project is part of my larger "),P=l(r,"A",{href:!0});var St=a(P);Be=h(St,"van overhaul"),St.forEach(t),Je=h(r,", however I thought it would make more sense to break out into its own article."),r.forEach(t),we=c(e),T=l(e,"P",{});var At=a(T);Ne=h(At,"For some context, when I bought my van it did not have any window regulators in. For some inexplicable reason the previous owner had decided to remove them and install electric windows, despite the fact that the vehicle didn\u2019t have a working engine. When I bought the van, it came with two electric window regulators, and the windows themselves were held up with pliers!"),At.forEach(t),pe=c(e),I=l(e,"P",{});var xt=a(I);He=h(xt,"This article shows my crude attempt at adding a DIY window control mechanism to my van, and some of the challenges surrounding the design\u2026"),xt.forEach(t),me=c(e),k=l(e,"P",{});var Ft=a(k);C=l(Ft,"IMG",{src:!0,alt:!0}),Ft.forEach(t),ve=c(e),W=l(e,"P",{});var Lt=a(W);Ye=h(Lt,"I should note that the design for this controller was largely dictated by what I had on hand, so by no means serves as a reference implementation! However, the key requirements of a controller are fairly basic, so there are likely many valid ways to build this device."),Lt.forEach(t),ye=c(e),j=l(e,"P",{});var Vt=a(j);qe=h(Vt,"The first major consideration is that many window regulators don\u2019t come with any kind of stopping mechanism fitted. Essentially you drive the window up/down until the motor stalls. A very simple controller would to simply have a DPDT switch that directly connects the window motors to a fused 12V line, however this does have some drawbacks:"),Vt.forEach(t),be=c(e),m=l(e,"UL",{});var q=a(m);U=l(q,"LI",{});var Bt=a(U);z=l(Bt,"P",{});var Jt=a(z);Oe=h(Jt,"The switches need to be rated for the full motor stall current. This could be as high as 35A!"),Jt.forEach(t),Bt.forEach(t),Ue=c(q),K=l(q,"LI",{});var Nt=a(K);Q=l(Nt,"P",{});var Ht=a(Q);ze=h(Ht,"If you hold down the switch while the window is at its limit, you are effectively shorting out your battery through a stalled motor coil. This may burn out your motor/get hot!"),Ht.forEach(t),Nt.forEach(t),Ke=c(q),R=l(q,"LI",{});var Yt=a(R);g=l(Yt,"P",{});var xe=a(g);Qe=h(xe,"You cannot implement smart features like "),X=l(xe,"EM",{});var qt=a(X);Re=h(qt,"single-touch"),qt.forEach(t),Xe=h(xe," window closing."),xe.forEach(t),Yt.forEach(t),q.forEach(t),_e=c(e),G=l(e,"P",{});var Ot=a(G);Ze=h(Ot,"Naturally, my first response was to go fully overkill, and design a fully software-controllable window controller based around the ubiquitous \u2018blue-pill\u2019 STM32 microcontroller. The schematic for my controller is shown below."),Ot.forEach(t),ge=c(e),D=l(e,"P",{});var Ut=a(D);M=l(Ut,"IMG",{src:!0,alt:!0}),Ut.forEach(t),Ee=c(e),S=l(e,"P",{});var zt=a(S);$e=h(zt,"This circuit is very simple, and can be modified to work with whatever components you happen to have on-hand. The core window control is done using 4 automotive relays, each driven by a simple BJT low-side switch. Virtually any rated N-Channel FET would suffice for this application."),zt.forEach(t),Pe=c(e),A=l(e,"P",{});var Kt=a(A);et=h(Kt,"This switching configuration uses standard SPDT automotive relays. By default both motor terminals are connected to GND. You can spin the motor in either direction by switching one of the relays. This circuit has two neat features:"),Kt.forEach(t),Te=c(e),y=l(e,"UL",{});var Fe=a(y);Z=l(Fe,"LI",{});var Qt=a(Z);$=l(Qt,"P",{});var Rt=a($);tt=h(Rt,"When the relays are off, the motor terminals are shorted together. This gives a nice return path for back-EMF, removing the need for any freewheeling diodes."),Rt.forEach(t),Qt.forEach(t),ot=c(Fe),ee=l(Fe,"LI",{});var Xt=a(ee);te=l(Xt,"P",{});var Zt=a(te);it=h(Zt,"There is no software configuration that can accidentally short out the supply rails as one can with H-Bridge topologies."),Zt.forEach(t),Xt.forEach(t),Fe.forEach(t),Ie=c(e),v=l(e,"P",{});var O=a(v);lt=h(O,"The \u2018stall\u2019 detection is done with "),oe=l(O,"CODE",{});var $t=a(oe);rt=h($t,"ACS172"),$t.forEach(t),at=h(O," hall-effect current sensors. These are cheap ICs that do not add considerable impedance to the measured current path. They are not particularly accurate, but that isn\u2019t too problematic in this scenario. The main drawback of the "),ie=l(O,"CODE",{});var eo=a(ie);st=h(eo,"ACS172"),eo.forEach(t),nt=h(O," is that it is a 5 Volt part. For interfacing with a 3V3 microcontroller I added voltage dividers to adjust the sensor range (throwing in a couple of 3V3 zener diodes doesn\u2019t hurt either)."),O.forEach(t),ke=c(e),x=l(e,"P",{});var to=a(x);ht=h(to,"The \u2018module\u2019 in its final form is shown below. It is by no means the most compact, but hey, overkill electrics is something of a theme in my van."),to.forEach(t),Ce=c(e),F=l(e,"P",{});var oo=a(F);L=l(oo,"IMG",{src:!0,alt:!0}),oo.forEach(t),We=c(e),V=l(e,"P",{});var io=a(V);dt=h(io,"All that was left was to program the software. While the software isn\u2019t a brain-melter, it isn\u2019t as straightforward as I initially thought. There are actually a number of different behaviours and states that need to be accounted for, along with safely handling any potential exceptions, for example:"),io.forEach(t),je=c(e),f=l(e,"UL",{});var b=a(f);le=l(b,"LI",{});var lo=a(le);re=l(lo,"P",{});var ro=a(re);ct=h(ro,"Holding the close button after the window has fully closed."),ro.forEach(t),lo.forEach(t),ft=c(b),ae=l(b,"LI",{});var ao=a(ae);se=l(ao,"P",{});var so=a(se);ut=h(so,"Automatically opening/closing the window if the switch is held down for a short period of time, but remaining in manual mode if held down for a long period of time."),so.forEach(t),ao.forEach(t),wt=c(b),ne=l(b,"LI",{});var no=a(ne);he=l(no,"P",{});var ho=a(he);pt=h(ho,"Cancelling auto-closing if user touches controls"),ho.forEach(t),no.forEach(t),mt=c(b),de=l(b,"LI",{});var co=a(de);ce=l(co,"P",{});var fo=a(ce);vt=h(fo,"Stopping window movements if the window hasn\u2019t reached a known state within a certain time window."),fo.forEach(t),co.forEach(t),b.forEach(t),Ge=c(e),B=l(e,"P",{});var uo=a(B);yt=h(uo,"Furthermore, our current thresholds for stalling are different depending on whether the window is moving up or down, and depending on whether the engine is running or not!"),uo.forEach(t),De=c(e),u=l(e,"P",{});var _=a(u);bt=h(_,"My software is implemented as a "),fe=l(_,"CODE",{});var wo=a(fe);_t=h(wo,"C++"),wo.forEach(t),gt=c(_),ue=l(_,"EM",{});var po=a(ue);Et=h(po,"Class State Machine"),po.forEach(t),Pt=h(_,", and is available on "),E=l(_,"A",{href:!0,rel:!0});var mo=a(E);Tt=h(mo,"GitHub"),mo.forEach(t),It=h(_,". It needs a bit of tweaking to get reliable operation, but is very solid once configured correctly."),_.forEach(t),Me=c(e),J=l(e,"P",{});var vo=a(J);N=l(vo,"IMG",{src:!0,alt:!0}),vo.forEach(t),Se=c(e),H=l(e,"P",{});var yo=a(H);kt=h(yo,"Was this controller a good idea when a couple of high-powered switches would have sufficed? Probably not."),yo.forEach(t),Ae=c(e),Y=l(e,"P",{});var bo=a(Y);Ct=h(bo,"But hey, my van is the epitome of projects that really don\u2019t justify the time put into them, but that\u2019s not really the point of these kind of projects\u2026 at least in my book!"),bo.forEach(t),this.h()},h(){w(P,"href","/projects/Van_Part_1"),Le(C.src,jt="https://cdn.bojit.org/img/posts/Power_Window_Controller-Design.JPG")||w(C,"src",jt),w(C,"alt","Power_Window_Controller-Design.JPG"),Le(M.src,Gt="https://cdn.bojit.org/img/posts/Power_Window_Controller-Schematic.PNG")||w(M,"src",Gt),w(M,"alt","Power_Window_Controller-Schematic.PNG"),Le(L.src,Dt="https://cdn.bojit.org/img/posts/Power_Window_Controller-Module.JPG")||w(L,"src",Dt),w(L,"alt","Power_Window_Controller-Module.JPG"),w(E,"href","https://github.com/BOJIT/power-window-controller"),w(E,"rel","nofollow"),Le(N.src,Mt="https://cdn.bojit.org/img/posts/Power_Window_Controller-Installed.JPG")||w(N,"src",Mt),w(N,"alt","Power_Window_Controller-Installed.JPG")},m(e,r){s(e,p,r),o(p,Ve),o(p,P),o(P,Be),o(p,Je),s(e,we,r),s(e,T,r),o(T,Ne),s(e,pe,r),s(e,I,r),o(I,He),s(e,me,r),s(e,k,r),o(k,C),s(e,ve,r),s(e,W,r),o(W,Ye),s(e,ye,r),s(e,j,r),o(j,qe),s(e,be,r),s(e,m,r),o(m,U),o(U,z),o(z,Oe),o(m,Ue),o(m,K),o(K,Q),o(Q,ze),o(m,Ke),o(m,R),o(R,g),o(g,Qe),o(g,X),o(X,Re),o(g,Xe),s(e,_e,r),s(e,G,r),o(G,Ze),s(e,ge,r),s(e,D,r),o(D,M),s(e,Ee,r),s(e,S,r),o(S,$e),s(e,Pe,r),s(e,A,r),o(A,et),s(e,Te,r),s(e,y,r),o(y,Z),o(Z,$),o($,tt),o(y,ot),o(y,ee),o(ee,te),o(te,it),s(e,Ie,r),s(e,v,r),o(v,lt),o(v,oe),o(oe,rt),o(v,at),o(v,ie),o(ie,st),o(v,nt),s(e,ke,r),s(e,x,r),o(x,ht),s(e,Ce,r),s(e,F,r),o(F,L),s(e,We,r),s(e,V,r),o(V,dt),s(e,je,r),s(e,f,r),o(f,le),o(le,re),o(re,ct),o(f,ft),o(f,ae),o(ae,se),o(se,ut),o(f,wt),o(f,ne),o(ne,he),o(he,pt),o(f,mt),o(f,de),o(de,ce),o(ce,vt),s(e,Ge,r),s(e,B,r),o(B,yt),s(e,De,r),s(e,u,r),o(u,bt),o(u,fe),o(fe,_t),o(u,gt),o(u,ue),o(ue,Et),o(u,Pt),o(u,E),o(E,Tt),o(u,It),s(e,Me,r),s(e,J,r),o(J,N),s(e,Se,r),s(e,H,r),o(H,kt),s(e,Ae,r),s(e,Y,r),o(Y,Ct)},p:Wt,i:Wt,o:Wt,d(e){e&&t(p),e&&t(we),e&&t(T),e&&t(pe),e&&t(I),e&&t(me),e&&t(k),e&&t(ve),e&&t(W),e&&t(ye),e&&t(j),e&&t(be),e&&t(m),e&&t(_e),e&&t(G),e&&t(ge),e&&t(D),e&&t(Ee),e&&t(S),e&&t(Pe),e&&t(A),e&&t(Te),e&&t(y),e&&t(Ie),e&&t(v),e&&t(ke),e&&t(x),e&&t(Ce),e&&t(F),e&&t(We),e&&t(V),e&&t(je),e&&t(f),e&&t(Ge),e&&t(B),e&&t(De),e&&t(u),e&&t(Me),e&&t(J),e&&t(Se),e&&t(H),e&&t(Ae),e&&t(Y)}}}const ko={title:"DIY Power Window Controller",date:"23-05-2022",published:!0,tile:{type:"image",image:"/tiles/2022-05-23-Power_Window_Controller.PNG"}};class Co extends go{constructor(p){super(),Eo(this,p,null,To,Po,{})}}export{Co as default,ko as metadata};
